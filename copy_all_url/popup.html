<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="css/style.css" />
<style type="text/css">

</style>
<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>

<script>
function copyToClipboard(str){
	var obj=document.getElementById("tempurl");
	if( obj ){
		obj.value = str;
		obj.select();
		document.execCommand("copy", false, null);
	}
}

function copy_html(tabs){
	var s = '';
	for (var i=0; i < tabs.length; i++) {
		s += '<a href="'+tabs[i].url+'">'+tabs[i].url+"</a><br/>";
		s = s + "\n";
	}
	return s;
}

function copy_text(tabs){
	var s = '';
	for (var i=0; i < tabs.length; i++) {
		s += tabs[i].url;
		s = s + "\n";
	}
	return s;
}

function copyallwindows() {
	var defaut = 'text';
	var format = localStorage["format"];
	if(!format){
		tmp = defaut;
	}
	
	win = chrome.windows.getCurrent(function(win) {
		chrome.tabs.getAllInWindow(win.id, function(tabs) {
			
			if(format == 'html')
				var s = copy_html(tabs);
			else
				var s = copy_text(tabs);
			
			copyToClipboard(s);
			//window.close();
		})
	});
}


//copyallwindows();
</script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>
<form>
	<textarea style="display:'';" id="tempurl"></textarea>
    <input type="button" id="copyUrl" value="copy">
    <input type="button" id="createUrl" value="create">
    <input type="button" id="write" value="Write">
    <input type="button" id="submit" value="Submit">
    <input type="button" onclick="change_selected()" value="change color" />
</form>
<script type="text/javascript">

$("#createUrl").click(function(){
	
	list = $("#tempurl").val().split("\n");
	for(var i=0;i<list.length;i++){
		chrome.tabs.create( { 
			url:list[i],
			index:(chrome.tabs.index),
			selected:false } 
		);
	}
	window.close();
	
});
$("#copyUrl").click(function(){
	var defaut = 'text';
	var format = localStorage["format"];
	if(!format){
		tmp = defaut;
	}
	
	win = chrome.windows.getCurrent(function(win) {
		chrome.tabs.getAllInWindow(win.id, function(tabs) {
			
			if(format == 'html')
				var s = copy_html(tabs);
			else
				var s = copy_text(tabs);
			
			copyToClipboard(s);
			window.close();
		})
	});
});

function change_color() {
  chrome.tabs.executeScript(null,
      {code:"document.body.style.backgroundColor='#ccc'"});
  window.close();
}

$("#write").click(function(){
	writeForm();
  	//window.close();
});

$("#submit").click(function(){
	
	for(var i=0;i<localStorage.length;i++){
		if(localStorage.key(i).substr(0,3) == 'an_'){
			var child_name = localStorage.key(i).substr(3);
			break;
			//chrome.tabs.executeScript(null,{code:"document.getElementsByName('"+localStorage.key(i).substr(3)+"')[0].value='"+localStorage.getItem(localStorage.key(i))+"'"});
		}
	}
	if(child_name != "undefined"){
		//alert(child_name);
		//alert(document.getElementsByName(child_name)[0].value);
		chrome.tabs.executeScript(null,{code:"document.getElementsByName('"+localStorage.key(i).substr(3)+"')[0].parentNode.submit()"});
	}
});

function submitForm(){
	$();
}

function writeForm(){
	for(var i=0;i<localStorage.length;i++){
		if(localStorage.key(i).substr(0,3) == 'an_'){
			chrome.tabs.executeScript(null,{code:"document.getElementsByName('"+localStorage.key(i).substr(3)+"')[0].value='"+localStorage.getItem(localStorage.key(i))+"'"});
		}
	}
}

function change_selected(){
	for(var i=0;i<localStorage.length;i++){
		alert(localStorage.key(i) + '**' + localStorage.getItem(localStorage.key(i)));
	}
	/*chrome.tabs.get(null,function(tabId){
		alert(tabId);
	});
	chrome.tabs.getSelected(null, function(tab) {
		lastTabId = tab.id;
		alert(tab.title);
		//chrome.pageAction.show(lastTabId);
	});
	chrome.tabs.update(
		{tabId:1},
		{selected:true},
		function(){}
	);*/
}
</script>
</body>
</html>
