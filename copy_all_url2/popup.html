<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="css/style.css" />
<style type="text/css">

</style>
<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>

<script>
function copyToClipboard(str){
	var obj=document.getElementById("tempurl");
	if( obj ){
		obj.value = str;
		obj.select();
		document.execCommand("copy", false, null);
	}
}

function copy_html(tabs){
	var s = '';
	for (var i=0; i < tabs.length; i++) {
		s += '<a href="'+tabs[i].url+'">'+tabs[i].url+"</a><br/>";
		s = s + "\n";
	}
	return s;
}

function copy_text(tabs){
	var s = '';
	for (var i=0; i < tabs.length; i++) {
		s += tabs[i].url;
		s = s + "\n";
	}
	return s;
}

function copyallwindows() {
	var defaut = 'text';
	var format = localStorage["format"];
	if(!format){
		tmp = defaut;
	}
	
	win = chrome.windows.getCurrent(function(win) {
		chrome.tabs.getAllInWindow(win.id, function(tabs) {
			
			if(format == 'html')
				var s = copy_html(tabs);
			else
				var s = copy_text(tabs);
			
			copyToClipboard(s);
			//window.close();
		})
	});
}


//copyallwindows();
</script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>
<form>
	<textarea style="display:'';" id="tempurl"></textarea>
    <input type="button" id="copyUrl" value="copy">
    <input type="button" id="createUrl" value="create">
</form>
<script type="text/javascript">

$("#createUrl").click(function(){
	
	list = $("#tempurl").val().split("\n");
	for(var i=0;i<list.length;i++){
		chrome.tabs.create( { 
			url:list[i],
			index:(chrome.tabs.index),
			selected:false } 
		);
	}
	window.close();
	
});
$("#copyUrl").click(function(){
	var defaut = 'text';
	var format = localStorage["format"];
	if(!format){
		tmp = defaut;
	}
	
	win = chrome.windows.getCurrent(function(win) {
		chrome.tabs.getAllInWindow(win.id, function(tabs) {
			
			if(format == 'html')
				var s = copy_html(tabs);
			else
				var s = copy_text(tabs);
			
			copyToClipboard(s);
			window.close();
		})
	});
});
</script>
</body>
</html>
